# pipeLine

- 线
- 三角形



# 设计

主要分为四个部分

### 应用阶段

这部分主要是处理模型和纹理这些内容

在TGAIMAGE和model中给出

### 几何阶段



### 光栅化

### 像素处理





**Triangle**

该类仅仅用于从给出的屏幕空间的顶点到画出三角形的过程



**MVP**

从model的坐标到$[-1,1]^3$



**从NDC到屏幕空间**



**多线程优化**

# pipeLine

使用cpp和eigen库完成基础的渲染管线

- 实现管线的核心功能
- 围绕核心功能去添加和修改



## 渲染管线

按照RTR中的划分来进行分为以下三个大阶段：

- 应用阶段
- 几何阶段
- 光栅化阶段



### 应用阶段

- 设置渲染状态
- 像GPU发生渲染指令

要求能够处理.obj文件和纹理

将顶点数据输入到下一个阶段



纹理的处理使用stb_image，通过一个类来包装，避免直接调用stb_image

obj的读取同样使用一个类来包装



#### 如何实现渲染状态的设置

*什么是渲染状态*
渲染状态定义了场景中网格是怎么样被渲染的，如：
- 使用哪个顶点着色器
- 光源属性
- 材质等
如果我们没有改变渲染状态，所有网格都将使用同一渲染状态





### 几何阶段

输入顶点数据，输出顶点对应的屏幕坐标

#### 顶点着色器

处理顶点，实现顶点的空间变换，把顶点坐标从模型空间转换到裁剪空间,完成透视除法，得到NDC空间的坐标

**并行处理**

#### 曲面细分着色器

略

#### 几何着色器

#### 裁剪

将不在摄像机视野内的顶点裁剪掉，或者提出某些三角图元的面片

#### 屏幕映射

将图元坐标转换到屏幕坐标系中

NDC->屏幕坐标

屏幕坐标和z坐标一起传输到光栅化阶段

#### 实现部分

实际上阶段应该完成的就是MVP变换再加上从NDC映射到屏幕空间的步骤，但是我们要注意的是裁剪的部分，这一块也是要考虑的

### 光栅化阶段

- 三角形设置
  - 计算光栅化一个三角形网格所需要的信息
- 三角形遍历
  - 检查三角形覆盖了哪些像素
- 像素着色
- 测试合并

### 表现

给出一个GUI，指定模型和纹理，输出渲染的图片

使用双缓冲



# 遇到的问题：

1.精度问题



2.计算mvp中的问题：

2.1计算view时的问题



2.2计算mvp对于z的影响

![image-20240306202144699](C:\Users\87784\AppData\Roaming\Typora\typora-user-images\image-20240306202144699.png)

z出现了问题，把背面的放回到了正面来
